<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">

<html>
<head>
	<title>lorisplay</title>
	 <LINK REL="stylesheet" TYPE="text/css" HREF="../manual.css" TITLE="formal">
</head>

<body bgcolor="white">
<!--
[[table  align="right" cellpadding="1" cellspacing="1" border="0"]]
	[[tr]]
		[[td width="45" align="right"]]
			[[a href="../manual2.htm#contents" target="_parent"]][[img src="../toc.gif" width="38" height="18" alt="Use Non-Frames Version" border="0"]][[/a]]
		[[/td]]
		[[td width="10"]][[/td]]
		[[td width="45" align="right"]]
			[[a href="guiro.htm"]][[img src="../prev.gif" width="38" height="18" alt="Previous Page" border="0"]][[/a]]
		[[/td]]
		[[td width="45" align="right"]]
			[[a href="pvread.htm"]][[img src="../next.gif" width="38" height="18" alt="Next Page" border="0"]][[/a]]
		[[/td]]
	[[/tr]]
[[/table]]
-->
Signal Generators: Bandwidth-Enhanced Additive Resynthesis, Sound Morphing

<hr size="1" color="#A9A9A9" noshade>

<h2>lorisread, lorisplay, lorismorph</h2>
<pre>
      <strong>lorisread</strong>    ktimpnt, ifilcod, istoreidx, kfreqenv, kampenv, kbwenv[, ifadetime]
  ar  <strong>lorisplay</strong>    ireadidx, kfreqenv, kampenv, kbwenv
      <strong>lorismorph</strong>   isrcidx, itgtidx, istoreidx, kfreqmorphenv, kampmorphenv, kbwmorphenv
</pre>
<hr size="2" color="#A9A9A9" noshade>

<h3>Description</h3>

<p>Output of <strong>lorisplay</strong> is a <em>Bandwidth-Enhanced</em>
additive reconstruction of a sound specified by a set of partials
obtained from a <em>Reassigned Bandwidth-Enhanced Analysis</em>
performed using the <strong>Loris</strong> software. The partials are
imported from a SDIF-format data file, and rendered with control-rate
frequency, amplitude, and bandwidth scaling.
</p>
<p>Output of <strong>lorismorph</strong> is the
<em>Bandwidth-Enhanced</em> additive synthesis of a <em>morph</em>
between two sets of partials, obtained from a <em>Reassigned
Bandwidth-Enhanced Analysis</em> performed using the
<strong>Loris</strong> software. The partials are imported from a
SDIF-format data file, and morphed according to a set of control-rate
frequency, amplitude, and bandwidth morphing envelopes.
</p>
<p>For more information about
<em>Bandwidth-Enhanced Additive Synthesis</em> and sound morphing 
using <strong>Loris</strong> and the <em>Reassigned Bandwidth-Enhanced 
Additive Model</em>, visit the <strong>Loris</strong> web site at <a
href="www.cerlsoundgroup.org/Loris/">www.cerlsoundgroup.org/Loris/</a>
</p>

<h3>Initialization</h3>

<p><em>ifilcod</em> &#8211; integer or character-string denoting a
control-file derived from reassigned bandwidth-enhanced analysis of an
audio signal. An integer denotes the suffix of a file
<em>loris.sdif</em> (e.g. <em>loris.sdif.1</em>); a character-string (in
double quotes) gives a filename, optionally a full pathname. If not
fullpath, the file is sought first in the current directory, then in the
one given by the environment variable <strong>SADIR</strong> (if defined).
</p>
<p> The <strong>lorisplay</strong> control file contains breakpoint
frequency, amplitude, noisiness, and phase envelope values organized for
bandwidth-enhanced additive resynthesis. The control data must conform
to one of the SDIF formats that can be interpreted using the
<strong>Loris</strong> library for sound modeling and manipulation.
Memory usage depends on the size of the files involved, which are read
and held entirely in memory during computation but are shared by
multiple calls. 
</p>

<p> <strong>Loris</strong> stores partials in SDIF RBEP frames. Each
RBEP frame contains one RBEP matrix, and each row in a RBEP matrix
describes one breakpoint in a <strong>Loris</strong> partial. A RBEL
frame containing one RBEL matrix describing the labeling of the partials
may precede the first RBEP frame in the SDIF file. The RBEP and RBEL
frame and matrix definitions are included in the SDIF file's header. In
addition to RBEP frames, <strong>Loris</strong> can also read and write
SDIF 1TRC frames.  Since 1TRC frames do not represent
bandwidth-enhancement or the exact timing of <strong>Loris</strong>
breakpoints, their use is not recommended. 1TRC capabilities are
provided to allow interchange with programs that are unable to handle
RBEP frames.
</p>

<p><em>ifadetime</em> (optional) &#8211; In general, partials exported
from <strong>Loris</strong> begin and end at non-zero amplitude. In
order to prevent artifacts, it is very often necessary to fade the
partials in and out, instead of turning them abruptly on and off.
Specification of a non-zero <em>ifadetime</em> causes partials to fade
in at their onsets and to fade out at their terminations. This is
achieved by adding two more breakpoints to each partial: one
<em>ifadetime</em> seconds before the start time and another
<em>ifadetime</em> seconds after the end time. (However, no breakpoint
will be introduced at a time less than zero. If necessary, the onset
fade time will be shortened.) The additional breakpoints at the partial
onset and termination will have the same frequency and bandwidth as the
first and last breakpoints in the partial, respectively, but their
amplitudes will be zero. The phase of the new breakpoints will be
extrapolated to preserve phase correctness. If no value is specified,
<em>ifadetime</em> defaults to zero. Note that the fadetime may not be
exact, since the partial parameter envelopes are sampled at the control
rate (krate) and indexed by <em>ktimpnt</em> (see below), and not by
real time. 
</p>


<h3>Performance</h3>
<p><strong>lorisplay</strong> implements signal reconstruction using
Bandwidth-Enhanced Additive Synthesis. The control data stems from a
pre-computed analysis file stored in SDIF format, as described above.
The passage of time through this file is specified by <em>ktimpnt</em>,
which represents the time in seconds. <em>ktimpnt</em> must always be
positive, but can move forwards or backwards in time, be stationary or
discontinuous, as a pointer into the analysis file. <em>kfreqenv</em> is
a control-rate transposition factor: a value of 1 incurs no
transposition, 1.5 transposes up a perfect fifth, and .5 down an octave.
<em>kampenv</em> is a control-rate scale factor that is applied to all
partial amplitude envelopes. <em>kbwenv</em> is a control-rate scale
factor that is applied to all partial bandwidth or noisiness envelopes.
</p>
<p><strong>lorismorph</strong> generates and renders a set of
bandwidth-enhanced partials by morphing the partials imported from the
control files <em>ifilcod0</em> and <em>ifilcod1</em>. The control data
stems from pre-computed analysis files stored in SDIF format, as
described above. The passage of time through these files is specified by
<em>ktimpnt</em>, which represents the time in seconds. <em>ktimpnt</em>
must always be positive, but can move forwards or backwards in time, be
stationary or discontinuous, as a pointer into the analysis file.
</p>

<p>The sound morph is described by three control-rate morphing
envelopes. The morph is performed by interpolating the parameters of
corresponding (labeled) partials in the two source sounds (for a full
explanation, visit the <strong>Loris</strong> web site at <a
href="www.cerlsoundgroup.org/Loris/">www.cerlsoundgroup.org/Loris/</a>).
<em>kfreqmorphenv</em> describes the interpolation of partial frequency
values in the two source sounds. When <em>kfreqmorphenv</em> is 0,
partial frequencies are obtained from the partials in <em>ifilcod0</em>.
When <em>kfreqmorphenv</em> is 1, partial frequencies are obtained from
the partials in <em>ifilcod1</em>. When <em>kfreqmorphenv</em> is
between 0 and 1, the partial frequencies are interpolated between the
two sources. Interpolation of partial amplitudes and bandwidth
(noisiness) coefficients are similarly described by
<em>kampmorphenv</em> and <em>kbwmorphenv</em>.
</p>


<p>This implementation of the <strong>Loris</strong> unit generators was
written by Kelly Fitz. It is patterned after a prototype implementation of the
<strong>lorisplay</strong> unit generator written by Corbin
Champion, and based on the method of
<em>Bandwidth-Enhanced Additive Synthesis</em> and on the sound morphing
algorithms implemented in the <strong>Loris</strong> library for sound
modeling and manipulation. For more information about
<em>Bandwidth-Enhanced Additive Synthesis</em>, <em>Reassigned
Bandwidth-Enhanced Additive Model</em>, and <strong>Loris</strong>,
visit the <strong>Loris</strong> web site at <a
href="www.cerlsoundgroup.org/Loris/">www.cerlsoundgroup.org/Loris/</a>
</p>


<h3>Examples</h3>
<p>Example 1
</p>
<pre><em>; 
; Play the partials in clarinet.sdif 
; from 0 to 3 sec with 1 ms fadetime 
; and no frequency , amplitude, or 
; bandwidth modification.
;</em>
instr 1
    ktime    <strong>linseg</strong>      0, p3, 3.0    <em>; linear time function from 0 to 3 seconds</em>
    asig     <strong>lorisplay</strong>   ktime, "clarinet.sdif", 1, 1, 1, .001
             <strong>out</strong>         asig
endin
</pre>

<p>Example 2
</p>
<pre><em>; 
; Play the partials in clarinet.sdif 
; from 0 to 3 sec with 1 ms fadetime 
; adding tuning and vibrato, increasing the 
; "breathiness" (noisiness) and overall
; amplitude, and adding a highpass filter.
;</em>
instr 2
    ktime    <strong>linseg</strong>      0, p3, 3.0    <em>; linear time function from 0 to 3 seconds</em>

    <em>; compute frequency scale for tuning
    ; (original pitch was G#4)</em>
    ifscale  <strong>=</strong>           cpspch(p4)/cpspch(8.08)

    <em>; make a vibrato envelope</em>
    kvenv    <strong>linseg</strong>      0, p3/6, 0, p3/6, .02, p3/3, .02, p3/6, 0, p3/6, 0
    kvib     <strong>oscil</strong>       kvenv, 4, 1   <em>; table 1, sinusoid</em>

    kbwenv   <strong>linseg</strong>      1, p3/6, 1, p3/6, 2, 2*p3/3, 2
    a1       <strong>lorisplay</strong>   ktime, "clarinet.sdif", ifscale+kvib, 2, kbwenv, .001  
    a2       <strong>atone</strong>       a1, 1000      <em>; highpass filter, cutoff 1000 Hz</em>
             <strong>out</strong>         a2
endin
</pre>
<p> The instrument in Example 1 synthesizes a clarinet tone from
beginning to end using partials derived from reassigned
bandwidth-enhanced analysis of a three-second clarinet tone, stored in
a file, "clarinet.sdif." The instrument in Example 2 adds tuning and
vibrato to the clarinet tone synthesized by <code>instr 1</code>,
boosts its amplitde and noisiness, and applies a highpass filter to
the result. The following score can be usd to test both of the
instruments described above.
</p>
<pre>
    ; make sinusoid in table 1
    f 1 0 4096 10 1
    
    ; play instr 1
    ;     strt   dur
    i 1    0      3
    i 1    +      1
    i 1    +      6
    
    ; play instr 2
    ;     strt   dur   ptch
    i 2    11     3    8.08
    i 2    13.5   1    8.04
    i 2    14     6    8.00
    i 2    14     6    8.07
    
    e
</pre>

p>Morphing Example
</p>
<pre><em>;
; Morph the partials in carhorn.sdif into
; the partials in meow.sdif linearly over 
; all but the last 2 seconds of the note.
; The morph is performed over the first 
; .75 seconds of the source sounds. The last
; 2.5 seconds (of meow) is unmodified.
; Use 1 ms fade time.
;</em>
instr 1
    ktime    <strong>linseg</strong>      0, p3-2.5, 0.75, 2.5, 3.5   <em>; time index function</em>
    kmorph   <strong>linseg</strong>      0, p3-2.5, 1.0, 2.5, 1.0    <em>; morphing function</em>
    asig     <strong>lorismorph</strong>  ktime, "carhorn.sdif", "meow.sdif", kmorph, kmorph, kmorph, .001
             <strong>out</strong>         asig
endin
</pre>

<p> The instrument in Example 1 performs a sound morph between a carhorn
and a cat's meow using reassigned bandwidth-enhanced partials stored in
"carhorn.sdif" and "meow.sdif." The morph is performed over all but the
last two seconds of the note, since <code>kmorph</code> changes from 
0 to 1 over <code>p3-2.5</code> seconds, and then remains constant (1.0)
for the remainder of the note. <code>ktime</code> changes from 0 to 0.75 over the
first <code>p3-2.5</code> seconds, so the morph is performed using the
first 0.75 seconds of the source partials. The remainder of the note
(2.5 seconds) uses only the partials from "meow.sdif."
</p>

<h3>Author</h3>
<p>Kelly Fitz<br>
WSU, Pullman<br>
2002<br>
email:<a href="mailto:loris@cerlsoundgroup.org">loris@cerlsoundgroup.org</a></p>

<p>
Last update: 29 May 2002
</p>

<hr size="2" color="#A9A9A9" noshade>
<!--
[[table  align="right" cellpadding="1" cellspacing="1" border="0"]]
	[[tr]]
		[[td width="45" align="right"]]
			[[a href="../manual2.htm#contents" target="_parent"]][[img src="../toc.gif" width="38" height="18" alt="Use Non-Frames Version" border="0"]][[/a]]
		[[/td]]
		[[td width="10"]][[/td]]
		[[td width="45" align="right"]]
			[[a href="guiro.htm"]][[img src="../prev.gif" width="38" height="18" alt="Previous Page" border="0"]][[/a]]
		[[/td]]
		[[td width="45" align="right"]]
			[[a href="pvread.htm"]][[img src="../next.gif" width="38" height="18" alt="Next Page" border="0"]][[/a]]
		[[/td]]
	[[/tr]]
[[/table]]
-->
Signal Generators: Bandwidth-Enhanced Additive Resynthesis, Sound Morphing
</body>

</html>
